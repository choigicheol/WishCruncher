<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../CSS/index.css" />
    <link rel="icon" href="./favicon.ico" />
    <title>WishCruncher</title>
  </head>
  <body>
    <header id="header_container">
      <nav id="header_area">
        <div class="header_menu">
          <a href="../index.html"><img src="../Images/logo.png" /></a>
        </div>
        <div class="header_menu header_text_menu">
          <span class="home_text_menu"><a href="../index.html">ν™</a></span>
          <span class="mypage_text_menu">λ§μ΄νμ΄μ§€</span>
        </div>
        <div class="header_menu login_menu">
          <span><a href="login.html">Login</a></span>
        </div>
      </nav>
    </header>
    <main id="signup_Page">
      <div id="signup_Page_Container">
        <form id="signup_Form">
          <div id="signup_Title">νμ›κ°€μ… π‰</div>
          <label class="input_Label" for="email_Input">μ΄λ©”μΌ</label>
          <div id="email_Input_Area">
            <!-- μ΄λ©”μΌ μ…λ ¥ -->
            <input
              id="signup_Email_Input"
              class="margin0_Input"
              type="email"
              name="email_Input"
              required
            />
            <div id="check_Email_Button">μ¤‘λ³µκ²€μ‚¬</div>
          </div>
          <div class="check_Warning_Message">
            <span id="check_Email_Fail_Message"
              >μ¤‘λ³µλλ” μ΄λ©”μΌμ΄ μ΅΄μ¬ν•©λ‹λ‹¤.</span
            >
            <span id="check_Email_Success_Message"
              >μ‚¬μ© κ°€λ¥ν• μ΄λ©”μΌμ…λ‹λ‹¤.</span
            >
            <span id="check_Email_Invalid_Message"
              >μ ν¨ν•μ§€ μ•μ€ μ΄λ©”μΌμ…λ‹λ‹¤.</span
            >
          </div>
          <!-- λ‹‰λ„¤μ„ μ…λ ¥ -->
          <label class="input_Label" for="nickname_Input">λ‹‰λ„¤μ„</label>
          <input id="nickname_input" name="nickname_Input" required />
          <!-- λΉ„λ°€λ²νΈ μ…λ ¥ -->
          <label class="input_Label" for="password_Input">λΉ„λ°€λ²νΈ</label>
          <input
            id="password_Input"
            type="password"
            name="password_Input"
            placeholder="8~16μ, μλ¬Έ λ€μ†λ¬Έμ, νΉμλ¬Έμλ¥Ό ν¬ν•¨ν•΄μ£Όμ„Έμ”."
            required
          />
          <!-- λΉ„λ°€λ²νΈ ν™•μΈ μ…λ ¥ -->
          <label class="input_Label" for="confirm_password_Input"
            >λΉ„λ°€λ²νΈ ν™•μΈ</label
          >
          <input
            id="confirm_Password_Input"
            class="margin0_Input"
            type="password"
            name="confirm_password_Input"
            required
          />
          <div class="check_Warning_Message">
            <span id="check_password_Invalid_Message"
              >λΉ„λ°€λ²νΈλ¥Ό λ‹¤μ‹ ν™•μΈν•΄μ£Όμ„Έμ”.</span
            >
          </div>
          <button
            id="signup_Submit_Button"
            name="signup_Submit_Button"
            class="submit_Button"
            disabled="false"
          >
            ν™•μΈ
          </button>
        </form>
        <div id="go_To_signUp">
          <a href="login.html">λ’¤λ΅κ°€κΈ°</a>
        </div>
      </div>
    </main>
    <footer>
      <a href="https://github.com/choigicheol" target="_blank">
        <div class="github_Link">
          <img src="../Images/github_Icon.svg" />
          <span>Choi Gi Cheol</span>
        </div>
      </a>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="../firebase.js"></script>
    <script>
      // μ ν¨μ„± κ²€μ‚¬
      function Inspect(data, type) {
        switch (type) {
          // 2~10κΈ€μ, μμ–΄, ν•κΈ€, μ«μλ§ κ°€λ¥
          case "nickname":
            const nickname = /^([a-zA-Z0-9κ°€-ν£]){2,10}$/;
            return nickname.test(data);
          case "email":
            const email =
              /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/;
            return email.test(data);
          case "password":
            const password =
              /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&]{8,16}/;
            //μµμ† 8μ λ° μµλ€ 16μ, λ€λ¬Έμ ν•λ‚ μ΄μƒ, μ†λ¬Έμ ν•λ‚ μ΄μƒ, μ«μ ν•λ‚ μ΄μƒ, νΉμ λ¬Έμ ν•λ‚ μ΄μƒ
            return password.test(data);
          default:
            return false;
        }
      }
      const checkEmail = document.querySelector("#check_Email_Button");
      const signupEmailInput = document.querySelector("#signup_Email_Input");
      let validEmail = false;

      // μ΄λ©”μΌ μ¤‘λ³µ λ²„νΌ μ΄λ²¤νΈ
      checkEmail.addEventListener("click", (e) => {
        e.preventDefault();
        const emailValue = signupEmailInput.value;
        firebase
          .auth()
          .signInWithEmailAndPassword(emailValue, "dummyPassword#9195")
          .catch((error) => {
            console.log(error.code);
            if (error.code === "auth/user-not-found") {
              check_Email_Fail_Message.style.display = "none";
              check_Email_Success_Message.style.display = "block";
              check_Email_Invalid_Message.style.display = "none";
              validEmail = true;
            } else if (error.code === "auth/invalid-email") {
              check_Email_Fail_Message.style.display = "none";
              check_Email_Success_Message.style.display = "none";
              check_Email_Invalid_Message.style.display = "block";
              validEmail = false;
            } else {
              check_Email_Fail_Message.style.display = "block";
              check_Email_Success_Message.style.display = "none";
              check_Email_Invalid_Message.style.display = "none";
              validEmail = false;
            }
            validButton(validEmail, validNickname, equalPasswordBoolean);
          });
      });

      // λ‹‰λ„¤μ„ ν™•μΈ
      const nicknameInput = document.querySelector("#nickname_input");
      let validNickname = false;
      nicknameInput.addEventListener("keyup", () => {
        if (Inspect(nicknameInput.value, "nickname")) {
          validNickname = true;
        } else {
          validNickname = false;
        }
      });

      // λΉ„λ°€λ²νΈ ν™•μΈ μ΄λ²¤νΈ
      const passwordInput = document.querySelector("#password_Input");
      const confirmPasswordInput = document.querySelector(
        "#confirm_Password_Input"
      );
      let equalPasswordBoolean = false;

      // λΉ„λ°€λ²νΈ, λΉ„λ°€λ²νΈν™•μΈ μ…λ ¥ λ™μΌν•μ§€ ν™•μΈν•λ” ν•¨μ
      function equalPassword(password, confirmPassword) {
        if (password === confirmPassword) {
          check_password_Invalid_Message.style.display = "none";
          equalPasswordBoolean = true;
        } else {
          check_password_Invalid_Message.style.display = "block";
          equalPasswordBoolean = false;
        }
      }

      // λ²„νΌ ν™μ„±ν™” μ΅°κ±΄ ν•¨μ
      function validButton(validEmail, validNickname, validPassword) {
        if (validEmail && validNickname && validPassword) {
          //TODO: λ²„νΌ ν™μ„±ν™”
        }
      }

      passwordInput.addEventListener("keyup", () => {
        if (Inspect(passwordInput.value, "password")) {
          check_password_Invalid_Message.style.display = "none";
        } else {
          check_password_Invalid_Message.style.display = "block";
        }
        equalPassword(passwordInput.value, confirmPasswordInput.value);
        validButton(validEmail, validNickname, equalPasswordBoolean);
      });

      confirmPasswordInput.addEventListener("keyup", () => {
        if (Inspect(confirmPasswordInput.value, "password")) {
          check_password_Invalid_Message.style.display = "none";
        } else {
          check_password_Invalid_Message.style.display = "block";
        }
        equalPassword(passwordInput.value, confirmPasswordInput.value);
        validButton(validEmail, validNickname, equalPasswordBoolean);
        console.log(validEmail, "validEmail");
        console.log(validNickname, "validNickname");
        console.log(equalPasswordBoolean, "equalPasswordBoolean");
      });

      // νμ›κ°€μ… λ²„νΌ μ΄λ²¤νΈ
      const signupForm = document.querySelector("#signup_Form");
      const signupSubmitButton = document.querySelector(
        "#signup_Submit_Button"
      );
      if (validEmail && validNickname && equalPasswordBoolean) {
        //TODO: μ•λλ„¤;;;;;;;
        signupForm.addEventListener("submit", (e) => {
          e.preventDefault();
        });
      }
    </script>
  </body>
</html>
